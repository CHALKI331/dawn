{% comment %}
  Infinite Random Honeycomb Grid
  - Displays 4 rows of gap-free, perfectly tessellated hexagons.
  - Each hexagon shows a random product image and links to its product page.
  - Each rowâ€™s content is duplicated for seamless infinite scrolling.
{% endcomment %}

{% assign products_array = collections.all.products %}
{% capture product_data_json %}
[
  {% for product in products_array %}
    {
      "url": "{{ product.url | escape }}",
      "image": "{% if product.featured_image %}{{ product.featured_image | img_url: '400x400' }}{% else %}https://via.placeholder.com/400{% endif %}"
    }{% unless forloop.last %},{% endunless %}
  {% endfor %}
]
{% endcapture %}

<div class="hexagon-scroll-container">
  <div class="hexagon-grid">
    {% assign total_rows = 4 %}
    {% assign hexagons_per_row = 12 %}
    {% for row in (0..total_rows-1) %}
      <div class="hexagon-row row-{{ row }}">
        {% for i in (1..hexagons_per_row) %}
          <a href="#" class="hexagon">
            <img src="" alt="Product Image">
          </a>
        {% endfor %}
        {%- comment -%}
          Duplicate the row for infinite scrolling
        {%- endcomment -%}
        {% for i in (1..hexagons_per_row) %}
          <a href="#" class="hexagon">
            <img src="" alt="Product Image">
          </a>
        {% endfor %}
      </div>
    {% endfor %}
  </div>
</div>

<script>
  // Parse the product data JSON into a JavaScript array.
  var productData = {{ product_data_json | strip_newlines }};
  
  // Helper function: returns a random product object.
  function getRandomProduct() {
    return productData[Math.floor(Math.random() * productData.length)];
  }
  
  // On DOMContentLoaded, assign a random product to each hexagon.
  document.addEventListener('DOMContentLoaded', function() {
    var hexagons = document.querySelectorAll('.hexagon');
    hexagons.forEach(function(hex) {
      var product = getRandomProduct();
      hex.href = product.url;
      var img = hex.querySelector('img');
      if (img) {
        img.src = product.image;
      }
    });
  });
  
  // Every 5 seconds, update one random hexagon with a new random product.
  function updateRandomHexagon() {
    var hexagons = document.querySelectorAll('.hexagon');
    var randomIndex = Math.floor(Math.random() * hexagons.length);
    var hex = hexagons[randomIndex];
    var product = getRandomProduct();
    hex.href = product.url;
    var img = hex.querySelector('img');
    if (img) {
      img.src = product.image;
    }
  }
  setInterval(updateRandomHexagon, 5000);
</script>

{% schema %}
{
  "name": "InfHexRandom",
  "settings": [],
  "presets": [
    {
      "name": "InfHexRandom",
      "category": "Custom"
    }
  ]
}
{% endschema %}
