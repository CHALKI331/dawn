{% comment %}
  Infinite Honeycomb Grid Section
  - 4 fixed rows in a perfect tessellated honeycomb (no gaps)
  - Each hexagon shows a random product image (assigned via JS) and links to its product page.
  - Each rowâ€™s content is duplicated for seamless horizontal scrolling.
{% endcomment %}

{% assign products_array = collections.all.products %}
{% capture product_data_json %}
[
  {% for product in products_array %}
    {
      "url": "{{ product.url | escape }}",
      "image": "{% if product.featured_image %}{{ product.featured_image | img_url: '400x400' }}{% else %}https://via.placeholder.com/400{% endif %}"
    }{% unless forloop.last %},{% endunless %}
  {% endfor %}
]
{% endcapture %}

{% assign hexagons_per_row = 12 %}

<div class="hexagon-scroll-container">
  <div class="hexagon-grid">
    {% for row in (0..3) %}
      <div class="hexagon-row row-{{ row }}" data-row="{{ row }}">
        {% for i in (1..hexagons_per_row) %}
          <a href="#" class="hexagon">
            <img src="" alt="Product Image">
          </a>
        {% endfor %}
        {%- comment -%} Duplicate row for infinite scroll {% endcomment -%}
        {% for i in (1..hexagons_per_row) %}
          <a href="#" class="hexagon">
            <img src="" alt="Product Image">
          </a>
        {% endfor %}
      </div>
    {% endfor %}
  </div>
</div>

<script>
  // Parse the product data JSON captured from Liquid
  var productData = {{ product_data_json | strip_newlines }};
  
  // Helper function to return a random product object
  function getRandomProduct() {
    return productData[Math.floor(Math.random() * productData.length)];
  }
  
  // On DOM load, assign each hexagon a random product's image and URL
  document.addEventListener('DOMContentLoaded', function() {
    var hexagons = document.querySelectorAll('.hexagon');
    hexagons.forEach(function(hex) {
      var product = getRandomProduct();
      hex.href = product.url;
      var img = hex.querySelector('img');
      if (img) {
        img.src = product.image;
      }
    });
  });
  
  // Optionally, update one random hexagon every 5 seconds
  function updateRandomHexagon() {
    var hexagons = document.querySelectorAll('.hexagon');
    var randomIndex = Math.floor(Math.random() * hexagons.length);
    var hex = hexagons[randomIndex];
    var product = getRandomProduct();
    hex.href = product.url;
    var img = hex.querySelector('img');
    if (img) {
      img.src = product.image;
    }
  }
  setInterval(updateRandomHexagon, 5000);
</script>

{% schema %}
{
  "name": "InfHex",
  "settings": [],
  "presets": [
    {
      "name": "InfHex",
      "category": "Custom"
    }
  ]
}
{% endschema %}
